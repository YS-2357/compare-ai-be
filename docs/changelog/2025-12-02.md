# 2025-12-02 변경 로그 (작성 예정)

- 멀티턴 컨텍스트 시도: 모델별 히스토리/요약 분리, 프롬프트에 `[대화 이력] + [현재 질문]` 명시, UI에서 모든 모델 응답을 history에 포함하도록 변경했으나, 실제 멀티턴 맥락 적용은 여전히 실패(모델이 이전 응답을 참조하지 않음).
- LLM 응답이 비어 있을 때 `raw_responses` 폴백 추가, 디버그 로그 추가, 미사용 헬퍼 정리.
- 멀티턴 컨텍스트 버그 수정: LangGraph가 `BaseMessage`로 변환한 히스토리를 `_render_history_for_model`·`_maybe_summarize_history`가 문자열화하지 못해 프롬프트의 `[대화 이력]`이 비던 문제를 `_message_to_text` 헬퍼 도입으로 해결(모든 메시지 타입을 `role: content`로 직렬화).
- 모델 호출/요약 파이프라인 재구성: `_call_model_common`으로 모델 호출/에러 핸들링을 일원화, `_maybe_summarize_history`로 모델별 컨텍스트가 `MAX_CONTEXT_MESSAGES`를 넘으면 요약 후 최근 메시지만 유지하도록 변경. partial 이벤트는 모델별 마지막 assistant 발화를 answer로 노출해 UI 스트림 일관성 확보.
- UI 멀티턴 전송/파서 정리: `chat_log` → LangGraph history 변환을 `_build_history_payload`로 표준화하고, partial/summary 스트림 파싱을 `_parse_stream_events`로 분리, 질문 전송을 `_send_question`으로 모듈화해 turn/히스토리 전송을 기본값으로 사용.
